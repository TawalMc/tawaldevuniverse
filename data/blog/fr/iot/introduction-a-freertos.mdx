---
title: 'Introduction √† FreeRTOS'
date: '2021-06-22'
tags: ['iot', 'freertos']
draft: false
summary: "D√©couvrons ensemble FreeRTOS, le syst√®me d'exploitation en temps r√©el d√©di√© aux microcontr√¥leurs."
images: ['https://miro.medium.com/max/2880/1*elMEPVMRFNKdpvVvZjLwoQ.png']
---

#### _Je voudrais pr√©ciser que tout le blog et mes futurs articles (d'ici la fin de ce mois) seront en anglais et plus en fran√ßais. D√©sol√© de l'annoncer ainsi mais je pr√©senterai bient√¥t les raisons._

_Cet article n'est pas pour un d√©butant en syst√®me embarqu√© mais il faut juste √™tre √† l'aise avec les micronctr√¥leurs._

![FreeRTOS-banner](https://miro.medium.com/max/2880/1*elMEPVMRFNKdpvVvZjLwoQ.png)

# Parlons de FreeRTOS

[FreeRTOS](https://www.freertos.org/) ou Free Real Time Operating Syst√®me est un kernel(noyau) multit√¢che (multitask) pour microcotr√¥leur.
Il vous permet donc (en simulant) l'ex√©cution de plusieurs t√¢ches en `en m√™me temps` un peu comme sur nos syst√®mes
d'exploitations habituels: Window, Linux, Android...o√π le mat√©riel dispose le plus souvent de plusieurs coeurs pour permettre
ce fonctionnement.
En consid√©rant la carte [Arduino](https://www.arduino.cc/) dot√©e de l'AVR, on peut donner
l'exemple suivant de plusieurs t√¢ches √† r√©aliser simultan√©ment:

- Afficher dans le moniteur s√©rie (Serial) la valeur retourn√©e par un capteur de temp√©rature - `t√¢che 1`
- Eteindre et allumer une led suivant une fr√©quence donn√©e - `t√¢che 2`
- Se connecter √† un serveur web via le module GSM par exemple, pour y envoyer l'√©tat de la led (vous pouvez en faire un TP üòé) - `t√¢che 3`

![mcu-without-rtos](/static/images/mcu_without_rtos.png)

_Un MCU sans RTOS et_

![mcu-with-rtos](/static/images/mcu_with_rtos.png)

_Un MCU avec FreeRTOS_

Comme les microcontr√¥leurs sont limit√©s en capacit√©s(m√©moires, processeurs, fr√©quence, ...), FreeRTOS a mis en place
une architecture (`je l'avoue puissante`) bas√©e sur l'utilisation correcte de la RAM et de son allocation, de gestionnaires de t√¢ches (`scheduler`), et pleins
d'autres fonctionnalit√©s que nous pouvons d√©couvrir par la suite.

# Que nous offre FreeRTOS

Actuellement je suis encore en train de lire le [guide tutoriel](https://www.freertos.org/fr-content-src/uploads/2018/07/161204_Mastering_the_FreeRTOS_Real_Time_Kernel-A_Hands-On_Tutorial_Guide.pdf) sur FreeRTOS qu'on peut
retrouver sur leur site (environ 400 pages üò≠, vous pouvez aller le lire aussi). Je vais n√©anmoins nous dispenser d'abord de certains points que je trouve un peu complexe et
utiliser dans les prochains articles le support pour Arduino.

### Avantages de FreeRTOS

- Chaque architecture (microcontr√¥leur/MCU) a ses caract√©ristiques et son design, donc FreeRTOS a √©t√© port√© sur diff√©rentes plateformes dont le ARM, AVR, Altera, NXP, Renesas,...[liste disponible ici](https://www.freertos.org/RTOS_ports.html)
- Utilisation efficiente de la RAM: allocation dynamique et statique de cette derni√®re lors de la compilation et de l'ex√©cution bas√©e sur l'utilisation du `heap` (tas) en √©vitant sa fragmentation
- Gestionnaire de t√¢ches et la facilit√© d'ajouter, supprimer et modifier l'ex√©cution des t√¢ches
- L'existence des `queue` pour la communication entre les t√¢ches: partage de donn√©es entre les t√¢ches,...
- La prise en charge des interruptions par exmple r√©cup√©rer l'appui sur un bouton sur une broche de notre carte
- Un syst√®me de timer, pour ex√©cuter une fonction/task √† une date dans le futur
- M√™me une version du `delay` utilis√© par les microcontr√¥leurs pour l'arr√™t momentan√© du programme mais ici utilis√© lors de l'ex√©cution des t√¢ches: `vTaskDelay()` - m√™me fonction
- Int√©gration des r√©f√©rences de AWS (Amazon Web Services) pour les projets IoT voulant se baser sur leur cloud - √† explorer
- Le support de l'OTA (Over The Air) updates ou `mise √† jour √† distance du code source` via l'int√©gration de AWS toujours pour les syst√®mes supportant l'OTA - √† explorer
- Des noms de fonctions assez parlants
- Pleins de d√©mos sur son utilisation et le code source est totalement ouvert et gratuit √† toute utilisation. Pour des options et fonctionnalit√©s vraiment avanc√©es des versions commerciales sont disponibles - ( _üòÇun ami √† moi cherchera partout en gratuit√© la version commerciale, c'est plus fort que luiüòÇ_ )

En lisant le manuel j'avoue que la mani√®re dont le syst√®me g√®re l'allocation de la m√©moire est vraiment bien pens√©e et √©vite les fuites de m√©moires au maximum mais aussi la fragmentation du tas d'allocation.
Par exemple son allocation de la ram se fait en allouant simplement (je le dis ainsi) un tableau √† taille fixe lors de la compilation si vous ne changer rien. Et c'est dans ce tableau
que les diff√©rentes allocations de m√©moires se feront. Diff√©rents algorithmes sont alors utilis√©s en fonction de vos besoins: `heap 1` √† `heap 5`.

### Concepts cl√©s de FreeRTOS

- Heap ou tas: "portion" de la RAM o√π les allocations de m√©moires (variables, allocation dynamique, task,...) sont faites
- Task ou t√¢ches: les t√¢ches √† ex√©cuter simultan√©ment qui ne sont rien d'autres que des fonctions en language C - comme d'hab.
- Queue: Syst√®me FIFO (First In First Out) de transmission de donn√©es entre les t√¢ches (variables, pointeurs...) et m√™me entre des t√¢ches √† ex√©cuter dans le futur ( _awesome_ )
- Interruption management: gestion des "interruptions" suite √† un √©v√®nement le plus souvent non p√©riodique.
- S√©maphore (√† voir).

# Donc?

Ok, nous venons de d√©couvrir rapidement FreeRTOS et ses avantages mais vous pouvez consulter [le manuel](https://www.freertos.org/fr-content-src/uploads/2018/07/161204_Mastering_the_FreeRTOS_Real_Time_Kernel-A_Hands-On_Tutorial_Guide.pdf) et m√™me [la r√©f√©rence](https://www.freertos.org/fr-content-src/uploads/2018/07/FreeRTOS_Reference_Manual_V10.0.0.pdf) pour en savoir plus.
Dans un prochain article nous testerons des codes sur la carte Arduino UNO en utilisant le support de FreeRTOS pour ce dernier.
N'h√©sitez pas √† me faire des retours dans mon mail ou sur mon Twitter ou Linkedin dont les r√©f√©rences sont en dessous.

Et sur ce: _can you smell what TawalMc is cooking?_
